

rule everything_mash_sketch:
    input:
        ["data/reads/runs/{run}/{lib}.fastq.gz".format(run=run, lib=lib) for run, lib in RUNLIB2SAMP],
    output:
        temp("data/mash/everything/k{ksize}-s{sketchsize}_everything_librun.msh"),
    log:
        "data/log/mash/everything/k{ksize}-s{sketchsize}.log"
    threads: 49
    shell:
        " mash sketch"
        "   -k {wildcards.ksize}"
        "   -s {wildcards.sketchsize}"
        "   -p {threads}"
        "   -o {output}"
        "   {input}"
        " >{log} 2>&1"


rule mashdist:
    input:
        "data/mash/everything/k{ksize}-s{sketchsize}_everything_librun.msh",
    output:
        dist="data/mash/everything/k{ksize}-s{sketchsize}_everything_librun.dist",
    log:
        "data/log/mash/everything/dist_k{ksize}-s{sketchsize}.log"
    threads: 48
    shell:
        "mash dist"
        "   -p {threads}"
        "   -t" # tabular format
        "   {input} {input}" # needs input twice
        " >{output}"
        " 2>{log}"

