# These rules are part of Acanthophis. See https://github.com/kdm9/Acanthophis.
# This file *could* be modified, but then be careful when you update them. And
# please, if you find a bug, raise an issue on github so the fix gets shared
# with everyone.
#
# Copyright 2018-2022 Kevin Murray/Gekkonid Consulting
#
# This Source Code Form is subject to the terms of the Mozilla Public License,
# v. 2.0. If a copy of the MPL was not distributed with this file, You can
# obtain one at http://mozilla.org/MPL/2.0/.

rule multiqc_samstats:
    input:
        stats=lambda wc: expand("alignments/bamstats/sample/{{aligner}}~{{ref}}~{sample}.samtools.stats", sample=config["SAMPLESETS"][wc.sampleset]),
    output:
        html="stats/multiqc/bamstats/{aligner}~{ref}~{sampleset}_multiqc_report.html",
    log:
        log="stats/multiqc/bamstats/{aligner}~{ref}~{sampleset}_multiqc_report.log",
    resources: **acanthophis.rule_resources(config, "multiqc_bamstats", time_min=30, mem_gb=2)
    conda: "envs/qcstats.yml"
    shell:
        "multiqc"
        "   --no-megaqc-upload"
        "   --flat"
        "   --no-data-dir"
        "   --comment 'Report for sample set {wildcards.sampleset}'"
        "   --filename {output.html}"
        "   {input}"
        " >{log} 2>&1"

